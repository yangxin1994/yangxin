// Generated by CoffeeScript 1.6.3
$(function() {
  var add_num_ipt, add_time_ipt, attr_type, render_attr;
  window.modelinker = new Modelinker;
  $('#myTab a').click(function(e) {
    e.preventDefault();
    return $(this).tab('show');
  });
  add_time_ipt = function($this) {
    var $parent, data;
    $parent = $this.closest('.bs-docs-example');
    data = gon.attr_data["" + ($parent.data('oid'))];
    data["" + (new_oid())] = "";
    return $this.closest('.controls-row').append("<div class=\"controls controls-row\">\n  <input class=\"span2\" type=\"text\" placeholder=\"年\">\n  " + (date_type > 0 ? "<input class=\"span1\" type=\"text\" placeholder=\"月\">" : void 0) + "\n  " + (date_type > 1 ? "<input class=\"span1\" type=\"text\" placeholder=\"日\">>" : void 0) + "\n  <span class=\"span1\">~</span>\n  <input class=\"span2\" type=\"text\" placeholder=\"年\">\n  " + (date_type > 0 ? "<input class=\"span1\" type=\"text\" placeholder=\"月\">" : void 0) + "\n  " + (date_type > 1 ? "<input class=\"span1\" type=\"text\" placeholder=\"日\">>" : void 0) + "\n  <span class=\"help-inline\">\n    <a href=\"javascript:void(0);\"><i class=\"icon-plus-sign\"></i></a>\n    <a href=\"javascript:void(0);\"><i class=\"icon-minus-sign\"></i></a>\n  </span>\n</div> ");
  };
  add_num_ipt = function() {
    return "";
  };
  render_attr = function(smp_attr) {
    var i, input, item, _i, _len, _ref;
    console.log(smp_attr);
    switch (smp_attr.type) {
      case 0:
        input = modelinker.generate({
          type: "textarea",
          linker: "attr." + smp_attr._id + "." + (Date.now()),
          html_attr: {
            rows: "6",
            placeholder: "字符串类型:请填写需要过滤的内容."
          }
        });
        break;
      case 1:
        input = "";
        _ref = smp_attr.enum_array;
        for (i = _i = 0, _len = _ref.length; _i < _len; i = ++_i) {
          item = _ref[i];
          input += "<label class=\"checkbox inline\">\n" + (modelinker.generate({
            type: "input",
            linker: "attr." + smp_attr._id + "." + i,
            html_attr: {
              type: "checkbox",
              value: i
            },
            html: item
          })) + "\n</label>";
        }
        break;
      case 2:
      case 4:
        input = "<div class=\"controls controls-row\">\n  <input class=\"span3\" type=\"text\" placeholder=\".span3\">\n  <input class=\"span3\" type=\"text\" placeholder=\".span3\">\n  <span class=\"help-inline\">\n    <a href=\"javascript:void(0);\"><i class=\"icon-plus-sign\"></i></a>\n    <a href=\"javascript:void(0);\"><i class=\"icon-minus-sign\"></i></a>\n  </span>\n</div>";
        break;
      case 3:
      case 5:
        input = "<div class=\"controls controls-row\">\n  <input class=\"span2\" type=\"text\" placeholder=\"年\">\n  <input class=\"span1\" type=\"text\" placeholder=\"月\">\n  <input class=\"span1\" type=\"text\" placeholder=\"日\">\n\n  <span class=\"span1\">~</span>\n\n  <input class=\"span2\" type=\"text\" placeholder=\"年\">\n  <input class=\"span1\" type=\"text\" placeholder=\"月\">\n  <input class=\"span1\" type=\"text\" placeholder=\"日\">\n  <span class=\"help-inline\">\n    <a href=\"javascript:void(0);\"><i class=\"icon-plus-sign\"></i></a>\n    <a href=\"javascript:void(0);\"><i class=\"icon-minus-sign\"></i></a>\n  </span>\n</div>        ";
        break;
      case 6:
        input = "<textarea rows=\"6\" placeholder=\"地址类型:请填写需要过滤的内容.\"></textarea>";
        break;
      case 7:
        input = "";
        break;
      default:
        input = "<div class=\"bs-docs-example\">\n  <textarea rows=\"6\" placeholder=\"我觉得还是重试吧!\"></textarea>\n</div>";
    }
    return "<div class=\"bs-docs-example\" \n     data-id=\"" + smp_attr._id + "\" \n     data-date_type=\"" + smp_attr.date_type + "\"\n     data-date_type=\"" + smp_attr.date_type + "\"\n     data-element_type=\"" + smp_attr.element_type + "\n     data-enum_array=\"" + smp_attr.enum_array + "\"\n     style=\"display:none\" >\n  <div class=\"row\">\n    <span class=\"span1\">\n    </span>  \n    <span class=\"span9\">\n      <p>\n        [" + (attr_type(smp_attr)) + "]" + smp_attr.name + "\n      </p>\n      " + input + "\n    </span>  \n    <span class=\"span2\">\n      <p>\n        <button class=\"btn btn-small btn-blocks btn-primary btn-attr-save\" type=\"button\">保存*</button>\n      </p>\n      <p>\n        <button class=\"btn btn-small btn-blocks btn-danger btn-attr-del\" type=\"button\">删除</button>\n      </p>\n      \n    </span>  \n  </div>\n</div>";
  };
  attr_type = function(smp_attr) {
    var get_type;
    get_type = function(_type) {
      switch (_type) {
        case 0:
          return "字符串";
        case 1:
          if (smp_attr.element_type === 1 || smp_attr.element_type === 7) {
            return "枚举";
          } else {
            return "枚举(" + (get_type(smp_attr.element_type)) + ")";
          }
          break;
        case 2:
          return "数值";
        case 3:
          return "日期";
        case 4:
          return "数值范围";
        case 5:
          return "日期范围";
        case 6:
          return "地址";
        case 7:
          if (smp_attr.element_type === 1 || smp_attr.element_type === 7) {
            return "数组";
          } else {
            return "数组(" + (get_type(smp_attr.element_type)) + ")";
          }
          break;
        default:
          return "";
      }
    };
    return get_type(smp_attr.type);
  };
  $("#attr_add_btn").click(function() {
    var $this;
    $this = $(this);
    return $.ajax({
      method: "GET",
      url: "sample_attributes",
      async: false,
      data: {
        id: gon.id
      },
      success: function(ret) {
        var btns_str, last_type, smp_attr, _i, _len, _ref, _results;
        if (ret.success) {
          btns_str = "<li><a href=\"#\">取消</a></li>";
          last_type = null;
          window.gon.smp_attrs = {};
          _ref = ret.value;
          _results = [];
          for (_i = 0, _len = _ref.length; _i < _len; _i++) {
            smp_attr = _ref[_i];
            window.gon.smp_attrs["" + smp_attr._id] = smp_attr;
            if (smp_attr.type !== last_type) {
              btns_str += "<li class=\"divider\"></li>";
            }
            btns_str += "<li><a href=\"#\" data-attr_id=\"" + smp_attr._id + "\" class=\"\">[" + (attr_type(smp_attr)) + "]" + smp_attr.name + "</a></li>";
            $("#btn_panel").html(btns_str);
            _results.push(last_type = smp_attr.type);
          }
          return _results;
        } else {
          return alert_msg.show('error', "系统繁忙请稍后再试 (╯‵□′)╯︵┻━┻");
        }
      },
      error: function() {
        return alert_msg.show('error', "系统繁忙请稍后再试 (╯‵□′)╯︵┻━┻");
      }
    });
  });
  $(document).on('click', '#btn_panel a', function() {
    var $this, smp_attr;
    $this = $(this);
    smp_attr = gon.smp_attrs["" + ($this.data('attr_id'))];
    $("#attr-placeholder").before(render_attr(smp_attr));
    return $("#attr-placeholder").prev().fadeIn(500);
  });
  false;
  $(document).on('click', ".btn-attr-del", function() {
    var $this, $this_div;
    $this = $(this);
    $this_div = $this.closest('.bs-docs-example');
    return $this_div.fadeOut(500);
  });
  return $(document).on('click', ".btn-attr-save", function() {
    var $this, $this_div;
    $this = $(this);
    $this_div = $this.closest('.bs-docs-example');
    if ($this.hasClass("disabled")) {

    } else {
      return $.ajax({
        method: "PUT",
        url: "update_sample_attribute",
        data: {
          sample_attribute: {
            sample_attribute_id: $this_div.data("id"),
            value: modelinker.get("attr." + ($this_div.data("id")))
          }
        },
        success: function(ret) {
          if (ret.success) {
            $this.closest(".attr-group").remove();
            $this.html("已保存").addClass("disabled");
            return alert_msg.show('success', "保存成功!");
          } else {
            return alert_msg.show('error', "保存失败 (╯‵□′)╯︵┻━┻");
          }
        },
        error: function() {
          return alert_msg.show('error', "保存失败 (╯‵□′)╯︵┻━┻");
        }
      });
    }
  });
});
